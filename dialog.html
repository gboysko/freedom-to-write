<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>Word Count</title>

		<!-- Latest compiled and minified CSS -->
		<link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">

		<!-- Optional theme -->
		<link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap-theme.min.css">

		<!-- Our application styles -->
		<link rel="stylesheet" href="./styles.css">
	</head>
	<body>
		<form class="form-inline">
			<fieldset id="loginFS">
				<div class="form-group">
			    <label for="emailInput">Email: </label>
			    <input type="email" class="form-control" id="emailInput" placeholder="Freedom Email">
			  </div>
			  <div class="form-group">
			    <label for="passwordInput">Password: </label>
			    <input type="password" class="form-control" id="passwordInput" placeholder="Password">
			  </div>
			  <button type="submit" id="signIn" class="btn btn-primary">Login</button>
				<span class="help-block" id="loginMsg"></span>
			</fieldset>
			<hr />
			<fieldset id="wordCountFS" disabled>
				<div class="form-group">
					<!-- This is just a label for the text input -->
					<label for="wordCount">Goal:</label>

					<!-- This is where the user enters her word count! -->
					<input type="text" id="wordCount" class="form-control" placeholder="N" autofocus>
					<span>words</span>

					<!-- Our button to accept the word count -->
					<button type="submit" id="setWordCount" class="btn btn-primary" disabled>OK</button>
				</div>
			</fieldset>
		</form>

		<hr/>

		<h2>Prior runs:</h2>

		<table class="table">
			<thead>
				<tr>
					<th>Date</th>
					<th>Words</th>
					<th>Time Taken</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<td>Dec 1, 2016</td>
					<td>500</td>
					<td>1 hour, 15 minutes</td>
				</tr>
				<tr>
					<td>Nov 20, 2016</td>
					<td>750</td>
					<td>2 hour, 30 minutes</td>
				</tr>
			</tbody>
		</table>


		<script>
			// Load jQuery, Bootstrap
			window.$ = window.jQuery = require('jquery');
			require('bootstrap');

			// Put the focus on the email field...
			$("#emailInput").focus();

			// Load the ipcRenderer class..
			const {ipcRenderer} = require('electron');

			// Handle keystrokes -- discard anything other than arrow key, delete, tab or digit
			$('#wordCount').on('keydown', e => {
				const isArrowKey = k => k >= 37 && k <= 40;
				const isDelete = k => k == 8;
				const isTab = k => k == 9;
				const isDigit = k => /[0-9]/.test(String.fromCharCode(k));

				return isArrowKey(e.which) || isTab(e.which) || isDelete(e.which) || isDigit(e.which);
			});

			// Check whether the text input has a number
			$('#wordCount').on('keyup', e => {
				// Disable the OK button if we DON'T have a number greater than 0
				$("#setWordCount").prop('disabled', !(parseInt(e.target.value, 10) > 0));
			});

			// Handle the SignIn button
			$("#signIn").on('click', event => {
				// Clear the previous help message
				$("#loginMsg").text("");

				// Disable the Login Field Set
				$("#loginFS").prop('disabled', true);

				// Attempt a login...
				ipcRenderer.send('set-freedom-creds', $("#emailInput").val(), $("#passwordInput").val());
			});

			// Handle the result of the login Attempt
			ipcRenderer.on('login-failure', (event, message) => {
				// Enable the Login Field Set
				$("#loginFS").prop('disabled', false);

				// Set the message
				$("#loginMsg").text(message);
				$("#loginFS").addClass("has-error");
			});

			ipcRenderer.on('login-success', (event) => {
				$("#loginMsg").text("Success");

				$("#loginFS").removeClass("has-error").addClass("has-success");

				// Enable the Word Count Field Set...
				$("#wordCountFS").prop('disabled', false);
			});

			// Handle the OK button
			$("#setWordCount").on('click', event => {
				// Tell the main program that we have collected the word count...
				ipcRenderer.send('set-word-count', parseInt($('#wordCount').val(), 10));

				// Close ourself!
				window.close();
			});
		</script>
	</body>
</html>
